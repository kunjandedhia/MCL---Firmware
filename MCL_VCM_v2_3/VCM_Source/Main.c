/******************************************************************************
* @file    Main.c
* 
* @brief   Main program body.
******************************************************************************
*/    
/* ----------------------------------------------------------------------------
*                           Includes
* ----------------------------------------------------------------------------
*/
	#include "Includes.h"
/* ----------------------------------------------------------------------------
*                           MACROS
* ----------------------------------------------------------------------------
*/
/* ----------------------------------------------------------------------------
*                           CONSTANTS
* ----------------------------------------------------------------------------
*/
/* ----------------------------------------------------------------------------
*                           GLOBAL VARIABLES
* ----------------------------------------------------------------------------
*/
/* ----------------------------------------------------------------------------
*                           EXTERNAL VARIABLES
* ----------------------------------------------------------------------------
*/
/* ----------------------------------------------------------------------------
*                           EXTERNAL FUNCTIONS
* ----------------------------------------------------------------------------
*/
/* ----------------------------------------------------------------------------
*                           FUNCTIONS DECLARATION
* ----------------------------------------------------------------------------
*/
/******************************************************************************
 **@Function 	 	 : main
 **@Description  : main 
 **@Parameters	 : None
 **@Return			 : None
 ****************************************************************************/
int main(void)
{
  fnSysInit();					/*Initialize peripherals*/
   	
	//#ifdef	GENERAL_DBG
		DEBUG_PRINTF("Start VCM \r\n");
	//#endif	
	
  TIM_Cmd(TIM1, ENABLE);
	while(1)
  {
		/* Process the received CAN1 data if available */
		if((ucCAN1ProcessCnt < ucStoreRxCANBuffCnt) || 
			 (SET == StatusFlag.stStatusFlag.bDataInCANRxBuffFlag)) 
		{
			fnCANMsg_Validate(&rgstRxCANBuff[ucCAN1ProcessCnt++]);
			
			if(RX_CAN_BUF_SIZE <= ucCAN1ProcessCnt)
			{
				ucCAN1ProcessCnt = 0;
				StatusFlag.stStatusFlag.bDataInCANRxBuffFlag = RESET;
			}
		}
		/************Check for the ESTOP message*****************/
			fnEstop_Check();

		/*************check the ACK received or not**************/
			fnCheck_ACK();

		/************check heartbeat received or not*************/
			fnCheck_HeartBeat();
		
		/******************Default mode**************************/
		fnDefault_Mode();
		
		/********************Operation Mode**********************/
		fnOperation_Mode();  

		/************Make LED blinking if CAN fault occurs*******/
		fnLED_Indication();
	}		
}
